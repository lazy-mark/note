# BASE理论

## 背景

BASE是Basecially Available（基本可用）、Soft state（软状态）和Eventually consistent（最终一致性）短语缩写，BASE是对CAP中的一致性和可用性权衡的结果，来源于大规模互联网系统分布式实际的总结，是基于CAP理论演化而来，其核心思想是即使无法做到强一致性（Strong consistency），但每个应用都可以根据自身业务特点，采用适当的方式来使系统达到最终一致性（Eventually consistency）。



## 基本可用

分布式系统在出现不可预知故障的时候，允许损失部分可用性【不等价于系统不可用】。

- 响应时间上的损失：正常情况下，一个在线搜索引擎需要0.5秒内返回给用户相应的查询结果，但由于出现异常（比如系统部分机房发生断电或断网故障），查询结果的响应时间增加到了1~2秒；
- 功能上的损失：正常情况下，在一个电商网站上进行购物，消费者几乎能够顺利地完成每一笔订单，但是在一些节日大促购物高峰的时候，由于消费者的购物行为激增，为了保护购物系统的稳定性，部分消费者可能会被引导到一个降级页面；



## 软状态

也称弱状态，和硬状态相对，是指允许系统中的数据存在中间状态，并认为该中间状态的存在不会影响系统的整体可用性，即允许系统在多个不同节点的数据副本存在数据延时。



## 最终一致性

上面说软状态，然后不可能一直是软状态，必须有个时间期限。在期限过后，应当保证所有副本保持数据一致性，从而达到数据的最终一致性。这个时间期限取决于网络延时、系统负载、数据复制方案设计等等因素。



案例：现代关系型数据库，同步或异步方式实现主备数据复制。



在实际中，最终一致性分为5种。

### 因果一致性

如果节点A在更新完某个数据后通知了节点B，那么节点B之后对该数据的访问和修改都是基于A更新后的值。于此同时，和节点A无因果关系的节点C的数据访问则没有这样的限制。



### 读已之所写

节点A更新一个数据后，它自身总是能访问到自身更新过的最新值，而不会看到旧值。其实也算一种因果一致性。



### 会话一致性

系统能保证在同一个有效的会话中实现 “读己之所写” 的一致性，也就是说，执行更新操作之后，客户端能够在同一个会话中始终读取到该数据项的最新值。



### 单调读一致性

如果一个节点从系统中读取出一个数据项的某个值后，那么系统对于该节点后续的任何数据访问都不应该返回更旧的值。



### 单调写一致性

一个系统要能够保证来自同一个节点的写操作被顺序的执行。



总体来说BASE理论面向的是大型高可用、可扩展的分布式系统。与传统ACID特性相反，不同于ACID的强一致性模型，**BASE提出通过牺牲强一致性来获得可用性，并允许数据段时间内的不一致，但是最终达到一致状态**。同时，在实际分布式场景中，不同业务对数据的一致性要求不一样。因此在设计中，ACID和BASE理论往往又会结合使用。



> 分布式系统是一个非常广泛的概念，它最终要落实到解决实际问题上，不同的问题有不同的方法和架构。所有的开源软件都是以某个应用场景出现，而纯粹以“分布式”概念进行划分的比较少见。

